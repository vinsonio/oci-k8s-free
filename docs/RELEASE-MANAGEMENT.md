# Release Management Guide

This project uses [release-please](https://github.com/googleapis/release-please) to automate versioning, changelog generation, and GitHub releases.

## How It Works

Release-please monitors commits on `main` branch for **conventional commit** messages. When changes are pushed, it:

1. **Analyzes commits** since the last release
2. **Determines version bump**:
   - `feat:` ‚Üí Minor version bump (0.0.1 ‚Üí 0.1.0)
   - `fix:` ‚Üí Patch version bump (0.0.1 ‚Üí 0.0.2)
   - `BREAKING CHANGE:` ‚Üí Major version bump (0.1.0 ‚Üí 1.0.0)
3. **Creates or updates a Pull Request** with:
   - Updated VERSION file
   - Updated CHANGELOG.md
4. **When PR is merged**, release-please:
   - Creates a GitHub release
   - Tags the commit with semantic version
   - Publishes release notes

## Commit Convention

All commits to `main` must follow **Conventional Commits** format:

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

### Valid Types

| Type       | Purpose          | Version Impact | Example                                |
| ---------- | ---------------- | -------------- | -------------------------------------- |
| `feat`     | New feature      | Minor bump     | `feat(bastion): add session logging`   |
| `fix`      | Bug fix          | Patch bump     | `fix(vpn): correct subnet routing`     |
| `docs`     | Documentation    | None           | `docs: update setup guide`             |
| `style`    | Code style       | None           | `style: format terraform files`        |
| `refactor` | Code restructure | None           | `refactor: simplify module variables`  |
| `perf`     | Performance      | None           | `perf(networking): optimize ACL rules` |
| `test`     | Tests            | None           | `test: add validation tests`           |
| `chore`    | Maintenance      | None           | `chore: update dependencies`           |

### Breaking Changes

For **major version updates**, include `BREAKING CHANGE:` in footer:

```
feat(kubernetes)!: migrate from OKE Basic to OKE Flexible

BREAKING CHANGE: Terraform variables have been reorganized.
See MIGRATION.md for details.
```

Or use `!` before the colon:

```
feat(api)!: restructure output variables
```

## Scopes

Common scopes for this project:

- **kubernetes** - OKE cluster configuration
- **networking** - VCN and network infrastructure
- **bastion** - OCI Bastion Service module
- **vpn** - Site-to-Site VPN configuration
- **observability** - Monitoring and logging
- **docs** - Documentation updates
- **ci** - GitHub Actions workflows
- **terraform** - Terraform version or provider updates

## Examples

### Regular fix

```
fix(networking): remove unused security list rule
```

### New feature with body

```
feat(kubernetes): add support for custom pod CIDRs

Allow users to specify custom pod network CIDR ranges
via new terraform variable `pod_cidr_block`.

Closes #123
```

### Breaking change

```
feat(variables)!: rename all variable names to follow Terraform naming conventions

BREAKING CHANGE: The following variables have been renamed:
- cluster_ocid ‚Üí kubernetes_cluster_ocid
- node_count ‚Üí kubernetes_node_pool_size
See MIGRATION.md for complete list.
```

### Documentation only (no version bump)

```
docs: update README with architecture diagram

Add visual architecture diagram to README.md explaining
the network segmentation between subnets.
```

## Local Testing

To test your commits before pushing:

```bash
# Install commitlint (optional, for local validation)
npm install --save-dev @commitlint/config-conventional @commitlint/cli

# Test commit message
echo "feat(kubernetes): add new feature" | commitlint
```

## Version File Updates

The `VERSION` file is automatically maintained by release-please. You should not edit it manually.

## Changelog

`CHANGELOG.md` is automatically generated by release-please. All entries are grouped by:

- üéâ **Features** (feat:)
- üêõ **Bug Fixes** (fix:)
- üìÑ **Documentation** (docs:)
- Other commit types (style, refactor, perf, test, chore)

## Release Workflow

### For Contributors

1. Make your changes
2. Commit with conventional commit message:
   ```bash
   git commit -m "feat(module): add new capability"
   ```
3. Push to your branch
4. Create Pull Request
5. ‚úÖ Merge to main once approved

### For Maintainers

When release-please creates a release PR:

1. **Review** the generated CHANGELOG.md and VERSION number
2. **Verify** the version bump is correct
3. **Merge** the PR with commit message:
   ```
   Merge release PR for v0.1.0
   ```
4. Release-please automatically:
   - Creates GitHub release at specified version
   - Attaches changelog to release notes
   - Tags the commit

## GitHub Workflows

Two workflows are active:

### `.github/workflows/terraform.yml`

- Runs on all PRs and pushes to `main`
- Validates Terraform configuration
- Runs TFLint

### `.github/workflows/release.yml`

- Runs release-please automation
- Creates/updates release PRs on push to `main`
- Creates releases when PRs are merged

## FAQ

**Q: I forgot to use conventional commits. What now?**
A: The commit history can be squashed when merging the PR. Use the PR title with conventional format.

**Q: How do I trigger a release manually?**
A: Release-please runs automatically on every push to `main`. Just push your commits.

**Q: Can I skip releasing for this commit?**
A: Add `[skip release]` or `[skip-release]` to the commit message:

```
fix: minor typo in docs [skip release]
```

**Q: Why did release-please skip my `docs:` commit?**
A: Documentation-only commits don't trigger version bumps. Add a `feat:` or `fix:` commit if you want to release.

**Q: How do I publish this to a package registry?**
A: This repo doesn't auto-publish. You can add a workflow to release OCI Terraform modules to a registry.

## References

- [Conventional Commits](https://www.conventionalcommits.org/)
- [release-please Documentation](https://github.com/googleapis/release-please)
- [Semantic Versioning](https://semver.org/)
